{% extends "base.html" %}

{% block title %}Dashboard{% endblock title %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/instructor/profile.css') }}">
{% endblock %}

{% block content %}
  <div class="container">
    <h2>Welcome, {{ instructor_email }}</h2>
    <div style="text-align: right;">
      <a href="/edit_instructor_profile" class="edit-link">Edit Profile</a>
    </div>

    <h3>Add New Subject</h3>

    {% if subject_count < 6 %}
      <form method="POST" action="/add_subject">
        <div class="form-group">
          <input type="text" name="subject" placeholder="Subject Name" required />
        </div>

        <div class="form-group">
          <label for="course_level">Course Level:</label>
          <select name="course_level" id="course_level" required>
            <option value="" disabled selected>Select Level</option>
            {% for level in range(1, 7) %}
              <option value="{{ level }}">{{ level }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="form-group">
          <input type="text" name="section" placeholder="Section" required />
        </div>

        <button type="submit">Add Subject</button>
      </form>
    {% else %}
      <p style="color: red;"><strong>You have reached the maximum limit of 6 subjects.</strong></p>
    {% endif %}

    <h3>Assigned Subjects</h3>

    {% for year_level, subjects in grouped_subjects.items() %}
      <h4>Year Level: {{ year_level }} ({{ subjects|length }} lists)</h4>
      {% if subjects %}
        <table>
          <thead>
            <tr>
              <th>Subject Code</th>
              <th>Section</th>
              <th>Number of Enrolled</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for subject in subjects %}
              <tr>
                <td>
                  <a href="/subject/{{ subject.id }}" class="subject-link">
                    {{ subject.subject_code or 'Unnamed Subject' }}
                    {% if subject.pending_count %}({{ subject.pending_count }}){% endif %}
                  </a>
                </td>
                <td>{{ subject.section or "No Section" }}</td>
                <td>{{ subject.enrolled_count or 0 }}</td>
                <td>
                  <a href="/delete_subject/{{ subject.id }}" class="delete-link" onclick="return confirm('Are you sure you want to delete this subject?')">Delete</a>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p>No subjects for {{ year_level }}.</p>
      {% endif %}
    {% endfor %}

    <div class="logout-link">
      <a href="/logout">Logout</a>
    </div>
  </div>
{% endblock %}
